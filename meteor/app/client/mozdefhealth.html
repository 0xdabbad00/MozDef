<!--
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
Copyright (c) 2014 Mozilla Corporation

Contributors:
Jeff Bryner jbryner@mozilla.com
Anthony Verez averez@mozilla.com
-->

<template name="mozdefhealth">
    <div class="container">
        Last update: {{lastupdate}}<br><br>

        <table class="table table-striped table-bordered table-hover table-condensed">
        <thead>
            <tr>
                <td>ES Cluster Name</td>
                <td>Cluster Status</td>
                <td>Nodes</td>
                <td>Data Nodes</td>
                <td>Active Shards</td>
                <td>Active Primary Shards</td>
                <td>Relocating Shards</td>
                <td>Initializing Shards</td>
                <td >Unassigned Shards</td>
            </tr>
        </thead>
        <tbody>
            {{#each esclusterhealthitems}}	    
                {{>esclusterHealthTableItem}}
            {{/each}}
        </tbody>
        </table>

        <table class="table table-striped table-bordered table-hover table-condensed">
        <thead>
            <tr>
                <td>Frontend node</td>
                <td>Load average</td>
                <td>Queue</td>
                <td>messages_ready</td>
                <td>messages_unacknowledged</td>
                <td>deliver_eps</td>
                <td>publish_eps</td>
            </tr>
        </thead>
        <tbody>
            {{#each frontendhealthitems}}
                {{>frontendHealthTableItem}}
            {{/each}}
        </tbody>
        </table>

        <table class="table table-striped table-bordered table-hover table-condensed">
        <thead>
            <tr>
                <td>ES node</td>
                <td>CPU usage</td>
                <td>Load averages</td>
                <td>JVM mem %</td>
                <td>disk free (GB)</td>
                <td>disk total (GB)</td>
            </tr>
        </thead>
        <tbody>
            {{#each esnodeshealthitems}}
                {{>esnodesHealthTableItem}}
            {{/each}}
        </tbody>
        </table>

        Hot threads:<br>
        <code>
            {{#each eshotthreadshealthitems}}
                {{line}}<br>
            {{/each}}
        </code><br><br>
    </div>

</template>

<template name="esclusterHealthTableItem">
    <tr>
        <td>{{cluster_name}}</td>
        <td>{{status}}</td>
        <td>{{number_of_nodes}}</td>
        <td>{{number_of_data_nodes}}</td>
        <td>{{active_shards}}</td>
        <td>{{active_primary_shards}}</td>
        <td>{{relocating_shards}}</td>
        <td>{{initializing_shards}}</td>
        <td>{{unassigned_shards}}</td>		
    </tr>
</template>

<template name="esnodesHealthTableItem">
    <tr>
        <td>{{hostname}}</td>
        <td>{{cpu_usage}}</td>
        <td>{{load}}</td>
        <td>{{mem_heap_per}}</td>
        <td>{{disk_free}}</td>
        <td>{{disk_total}}</td>
    </tr>
</template>

<template name="frontendHealthTableItem">
    <tr>
        <td>{{hostname}}</td>
        <td>{{details.loadaverage}}</td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
    </tr>
    {{#if details.events}}
        <tr>
            <td></td>
            <td></td>
            <td>events</td>
            <td>{{details.events.messages_ready}}</td>
            <td>{{details.events.messages_unacknowledged}}</td>
            <td>{{details.events.deliver_eps}}</td>
            <td>{{details.events.publish_eps}}</td>
        </tr>
    {{/if}}
    {{#if details.eventtask}}
        <tr>
            <td></td>
            <td></td>
            <td>eventtask</td>
            <td>{{details.eventtask.messages_ready}}</td>
            <td>{{details.eventtask.messages_unacknowledged}}</td>
            <td>{{details.eventtask.deliver_eps}}</td>
            <td>{{details.eventtask.publish_eps}}</td>
        </tr>
    {{/if}}
</template>

